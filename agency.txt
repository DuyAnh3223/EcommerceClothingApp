âœ… Má»¤C TIÃŠU
Khi Ä‘Äƒng kÃ½ tÃ i khoáº£n, cho phÃ©p chá»n role user hoáº·c agency.

Agency cÃ³ thá»ƒ táº¡o sáº£n pháº©m, nhÆ°ng pháº£i Ä‘Æ°á»£c admin duyá»‡t thÃ¬ má»›i hiá»ƒn thá»‹.

Khi sáº£n pháº©m Ä‘Æ°á»£c bÃ¡n, há»‡ thá»‘ng cá»™ng thÃªm phÃ­ sÃ n (vÃ­ dá»¥ 20%).

ğŸ§± Cáº¤U TRÃšC CSDL Cáº¦N Cáº¬P NHáº¬T
1. âœ… Cáº­p nháº­t báº£ng users Ä‘á»ƒ thÃªm agency
Hiá»‡n táº¡i

sql
Copy
Edit
`role` enum('user','admin') DEFAULT 'user'
ğŸ‘‰ Sá»­a thÃ nh

sql
Copy
Edit
`role` enum('user','admin','agency') DEFAULT 'user'
2. âœ… ThÃªm trÆ°á»ng created_by vÃ  approval_status vÃ o báº£ng products
Äá»ƒ biáº¿t sáº£n pháº©m nÃ o lÃ  cá»§a agency, vÃ  cÃ³ Ä‘Æ°á»£c admin duyá»‡t hay chÆ°a.

sql
Copy
Edit
ALTER TABLE products
ADD COLUMN created_by INT DEFAULT NULL, -- id cá»§a agency táº¡o sáº£n pháº©m
ADD COLUMN approval_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
ADD FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL;
3. âœ… ThÃªm trÆ°á»ng platform_fee_percent vÃ o product_variant
Äá»ƒ tÃ­nh giÃ¡ bÃ¡n cÃ³ cá»™ng phÃ­ sÃ n (vÃ­ dá»¥ 20%)

sql
Copy
Edit
ALTER TABLE product_variant
ADD COLUMN platform_fee_percent DECIMAL(5,2) DEFAULT 0.00;
ğŸ’¡ Náº¿u giÃ¡ gá»‘c lÃ  5000, platform_fee_percent = 20.00, thÃ¬ giÃ¡ bÃ¡n trÃªn app lÃ 

sql
Copy
Edit
final_price = price  (1 + platform_fee_percent  100)
ğŸ”„ LUá»’NG CHá»¨C NÄ‚NG (QUY TRÃŒNH)
âœ… 1. ÄÄƒng kÃ½ tÃ i khoáº£n
Giao diá»‡n Ä‘Äƒng kÃ½ thÃªm má»¥c chá»n vai trÃ² user hoáº·c agency.

LÆ°u vÃ o báº£ng users.role.

âœ… 2. Gá»­i sáº£n pháº©m lÃªn sÃ n (chá»‰ dÃ nh cho agency)
Agency táº¡o sáº£n pháº©m (chÃ¨n vÃ o báº£ng products) â†’ created_by = agency_id, approval_status = 'pending'.

Admin xem danh sÃ¡ch sáº£n pháº©m WHERE approval_status = 'pending', cÃ³ thá»ƒ duyá»‡t (approved) hoáº·c tá»« chá»‘i (rejected).

âœ… 3. Khi duyá»‡t sáº£n pháº©m
Sau khi admin duyá»‡t (approval_status = 'approved'), sáº£n pháº©m má»›i Ä‘Æ°á»£c hiá»ƒn thá»‹ cho khÃ¡ch.

LÃºc nÃ y, product_variant cÃ³ thá»ƒ chá»©a giÃ¡ bÃ¡n gá»‘c vÃ  pháº§n trÄƒm phÃ­ sÃ n.

VD price = 5000, platform_fee_percent = 20.00

âœ… 4. Khi hiá»ƒn thá»‹ sáº£n pháº©m trÃªn app
App láº¥y giÃ¡ bÃ¡n tÃ­nh theo cÃ´ng thá»©c

sql
Copy
Edit
SELECT 
  pv.price,
  pv.platform_fee_percent,
  ROUND(pv.price  (1 + pv.platform_fee_percent  100), 0) AS final_price
FROM product_variant pv
JOIN products p ON p.id = pv.product_id
WHERE p.approval_status = 'approved';
âœ… 5. Khi cÃ³ Ä‘Æ¡n hÃ ng
order_items.price váº«n lÆ°u giÃ¡ Ä‘Ã£ cá»™ng phÃ­ sÃ n (giÃ¡ mÃ  khÃ¡ch tráº£).

CÃ³ thá»ƒ lÆ°u thÃªm phÃ­ sÃ n vÃ  thu nháº­p cá»§a agency trong báº£ng order_items hoáº·c bÃ¡o cÃ¡o.

ğŸ“¦ Gá»£i Ã½ nÃ¢ng cao (khÃ´ng báº¯t buá»™c)
Táº¡o báº£ng agency_payouts Ä‘á»ƒ tá»•ng há»£p doanh thu agency sau khi trá»« phÃ­.

Táº¡o trang quáº£n lÃ½ sáº£n pháº©m cá»§a agency (dá»±a vÃ o created_by).

Log duyá»‡t sáº£n pháº©m (ai duyá»‡t, lÃºc nÃ o).

âœ… Káº¾T LUáº¬N
Báº¡n cáº§n thá»±c hiá»‡n

Cáº­p nháº­t báº£ng users Ä‘á»ƒ thÃªm vai trÃ² agency

ThÃªm cÃ¡c trÆ°á»ng quáº£n lÃ½ sáº£n pháº©m do agency gá»­i (created_by, approval_status)

ThÃªm platform_fee_percent Ä‘á»ƒ tÃ­nh giÃ¡ cuá»‘i cÃ¹ng

XÃ¢y dá»±ng giao diá»‡n gá»­i sáº£n pháº©m, duyá»‡t sáº£n pháº©m, vÃ  hiá»ƒn thá»‹ giÃ¡ Ä‘Ã£ cá»™ng phÃ­