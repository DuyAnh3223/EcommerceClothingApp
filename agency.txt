✅ MỤC TIÊU
Khi đăng ký tài khoản, cho phép chọn role user hoặc agency.

Agency có thể tạo sản phẩm, nhưng phải được admin duyệt thì mới hiển thị.

Khi sản phẩm được bán, hệ thống cộng thêm phí sàn (ví dụ 20%).

🧱 CẤU TRÚC CSDL CẦN CẬP NHẬT
1. ✅ Cập nhật bảng users để thêm agency
Hiện tại

sql
Copy
Edit
`role` enum('user','admin') DEFAULT 'user'
👉 Sửa thành

sql
Copy
Edit
`role` enum('user','admin','agency') DEFAULT 'user'
2. ✅ Thêm trường created_by và approval_status vào bảng products
Để biết sản phẩm nào là của agency, và có được admin duyệt hay chưa.

sql
Copy
Edit
ALTER TABLE products
ADD COLUMN created_by INT DEFAULT NULL, -- id của agency tạo sản phẩm
ADD COLUMN approval_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
ADD FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL;
3. ✅ Thêm trường platform_fee_percent vào product_variant
Để tính giá bán có cộng phí sàn (ví dụ 20%)

sql
Copy
Edit
ALTER TABLE product_variant
ADD COLUMN platform_fee_percent DECIMAL(5,2) DEFAULT 0.00;
💡 Nếu giá gốc là 5000, platform_fee_percent = 20.00, thì giá bán trên app là

sql
Copy
Edit
final_price = price  (1 + platform_fee_percent  100)
🔄 LUỒNG CHỨC NĂNG (QUY TRÌNH)
✅ 1. Đăng ký tài khoản
Giao diện đăng ký thêm mục chọn vai trò user hoặc agency.

Lưu vào bảng users.role.

✅ 2. Gửi sản phẩm lên sàn (chỉ dành cho agency)
Agency tạo sản phẩm (chèn vào bảng products) → created_by = agency_id, approval_status = 'pending'.

Admin xem danh sách sản phẩm WHERE approval_status = 'pending', có thể duyệt (approved) hoặc từ chối (rejected).

✅ 3. Khi duyệt sản phẩm
Sau khi admin duyệt (approval_status = 'approved'), sản phẩm mới được hiển thị cho khách.

Lúc này, product_variant có thể chứa giá bán gốc và phần trăm phí sàn.

VD price = 5000, platform_fee_percent = 20.00

✅ 4. Khi hiển thị sản phẩm trên app
App lấy giá bán tính theo công thức

sql
Copy
Edit
SELECT 
  pv.price,
  pv.platform_fee_percent,
  ROUND(pv.price  (1 + pv.platform_fee_percent  100), 0) AS final_price
FROM product_variant pv
JOIN products p ON p.id = pv.product_id
WHERE p.approval_status = 'approved';
✅ 5. Khi có đơn hàng
order_items.price vẫn lưu giá đã cộng phí sàn (giá mà khách trả).

Có thể lưu thêm phí sàn và thu nhập của agency trong bảng order_items hoặc báo cáo.

📦 Gợi ý nâng cao (không bắt buộc)
Tạo bảng agency_payouts để tổng hợp doanh thu agency sau khi trừ phí.

Tạo trang quản lý sản phẩm của agency (dựa vào created_by).

Log duyệt sản phẩm (ai duyệt, lúc nào).

✅ KẾT LUẬN
Bạn cần thực hiện

Cập nhật bảng users để thêm vai trò agency

Thêm các trường quản lý sản phẩm do agency gửi (created_by, approval_status)

Thêm platform_fee_percent để tính giá cuối cùng

Xây dựng giao diện gửi sản phẩm, duyệt sản phẩm, và hiển thị giá đã cộng phí